<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oldegle - Omegle Clone</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f4f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .container {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            padding: 20px;
            box-sizing: border-box;
            margin-top: 20px;
        }
        h1 {
            color: #4CAF50;
            font-size: 2.5em;
            text-align: center;
        }
        #username-input-container {
            text-align: center;
        }
        input[type="text"] {
            padding: 10px;
            width: 75%;
            font-size: 1.1em;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        button {
            padding: 12px 20px;
            background-color: #4CAF50;
            color: #fff;
            font-size: 1em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        #status {
            text-align: center;
            font-size: 1.2em;
            margin-top: 20px;
            color: #555;
        }
        #video-call-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        video {
            width: 48%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        #chat-container {
            display: none;
        }
        #messages {
            max-height: 300px;
            overflow-y: auto;
            background-color: #fff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        input[type="text"]#message-input {
            width: 75%;
        }
        #donation-container {
            text-align: center;
            margin-top: 30px;
        }
        .donation-button {
            padding: 12px 20px;
            background-color: #FFB300;
            color: white;
            border-radius: 4px;
            font-size: 1.1em;
            text-decoration: none;
            cursor: pointer;
        }
        .donation-button:hover {
            background-color: #e69f00;
        }
        /* About Section */
        #about-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        #about-container h2 {
            color: #4CAF50;
            font-size: 2em;
            text-align: center;
        }
        #about-container p {
            font-size: 1.2em;
            color: #555;
            line-height: 1.6;
            text-align: center;
        }

        /* Donation History Table Section */
        #donation-history {
            margin-top: 30px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 150px; /* Limit the height */
        }

        #donation-history table {
            width: 100%;
            border-collapse: collapse;
        }

        #donation-history table, #donation-history th, #donation-history td {
            border: 1px solid #ddd;
        }

        #donation-history th, #donation-history td {
            padding: 10px;
            text-align: center;
        }

        #donation-history tbody {
            display: block;
            height: 120px;
            overflow-y: auto;
        }

        #donation-history tbody tr {
            display: block;
            animation: scroll-up 10s linear infinite;
        }

        /* Scroll effect */
        @keyframes scroll-up {
            0% {
                transform: translateY(100%);
            }
            100% {
                transform: translateY(-100%);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to Oldegle - Video Chat</h1>

        <div id="username-input-container">
            <input type="text" id="username-input" placeholder="Enter your username" />
            <button id="start-chat">Start Chat</button>
        </div>

        <div id="status"></div>

        <div id="chat-container">
            <div id="messages"></div>
            <div>
                <input type="text" id="message-input" placeholder="Type a message..." />
                <button id="send-button">Send</button>
            </div>
            <button id="end-chat-button">End Chat</button>
        </div>

        <!-- Video Call UI -->
        <div id="video-call-container">
            <video id="local-video" autoplay muted></video>
            <video id="remote-video" autoplay></video>
        </div>

        <!-- Donation Section -->
        <div id="donation-container">
            <h2>Support Us with a Donation</h2>
            <p>Your support helps keep Oldegle running!</p>
            <!-- PayPal Donation Button -->
            <a class="donation-button" href="https://www.paypal.com/donate?hosted_button_id=XXXXXX" target="_blank">
                Donate via PayPal
            </a>
        </div>

        <!-- About Us Section -->
        <div id="about-container">
            <h2>About Us</h2>
            <p>
                Oldegle is a platform designed to bring elderly people together, helping them
                connect with others and reduce feelings of loneliness. We believe in the power of 
                communication to improve mental well-being and foster a sense of community.
            </p>
            <p>
                Our mission is to provide a space where elderly people can connect with each other
                easily through video calls. We also aim to use the donations we receive to support
                orphaned children and assist older individuals in need. Your generous support helps
                us keep this service running.
            </p>
            <p>
                Thank you for being part of this initiative and helping us spread joy to others.
            </p>
        </div>

        <!-- Donation History Section -->
        <div id="donation-history">
            <h2>Recent Donors</h2>
            <table>
                <thead>
                    <tr>
                        <th>Donor Name</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody id="donation-history-body">
                    <tr>
                        <td>John Doe</td>
                        <td>Thank you for your support to needful people!</td>
                    </tr>
                    <tr>
                        <td>Jane Smith</td>
                        <td>Supporting the cause of elderly care.</td>
                    </tr>
                    <tr>
                        <td>Mike Johnson</td>
                        <td>Happy to help orphaned kids and elderly.</td>
                    </tr>
                    <tr>
                        <td>Sarah Lee</td>
                        <td>Hope this helps those in need!</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const startChatButton = document.getElementById('start-chat');
        const statusDiv = document.getElementById('status');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const endChatButton = document.getElementById('end-chat-button');
        const chatContainer = document.getElementById('chat-container');
        const messagesDiv = document.getElementById('messages');
        const localVideo = document.getElementById('local-video');
        const remoteVideo = document.getElementById('remote-video');
        const usernameInput = document.getElementById('username-input');

        let socket;
        let username = '';
        let localStream;
        let peerConnection;
        let remoteStream;

        // Handle start chat
        startChatButton.addEventListener('click', () => {
            username = usernameInput.value.trim();
            if (username) {
                socket = new WebSocket('ws://localhost:4000');
                socket.addEventListener('open', () => {
                    socket.send(username);
                });
                setupSocket();
                startLocalVideo();
            } else {
                alert('Please enter a username!');
            }
        });

        // Setup WebSocket listeners
        function setupSocket() {
            socket.addEventListener('message', (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'offer') {
                    handleOffer(message);
                } else if (message.type === 'answer') {
                    handleAnswer(message);
                } else if (message.type === 'candidate') {
                    handleCandidate(message);
                }
            });

            sendButton.addEventListener('click', () => {
                const message = messageInput.value.trim();
                if (message) {
                    socket.send(JSON.stringify({ type: 'message', content: message }));
                    messagesDiv.innerHTML += `<div class="message user-message">You: ${message}</div>`;
                    messageInput.value = '';
                    messageInput.focus();
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }
            });

            endChatButton.addEventListener('click', () => {
                socket.send('end-chat');
                statusDiv.textContent = 'You ended the chat. Searching for a new partner...';
                chatContainer.style.display = 'none';
                stopLocalVideo();
            });
        }

        // Start local video stream
        async function startLocalVideo() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localVideo.srcObject = localStream;
            } catch (err) {
                console.error('Error accessing media devices.', err);
            }
        }

        // Stop local video stream
        function stopLocalVideo() {
            if (localStream) {
                const tracks = localStream.getTracks();
                tracks.forEach(track => track.stop());
            }
        }

        // Handle offer message (Initiate WebRTC connection)
        function handleOffer(offer) {
            peerConnection = new RTCPeerConnection();
            peerConnection.addEventListener('icecandidate', handleICECandidate);
            peerConnection.addEventListener('track', handleTrack);
            localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

            peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
            peerConnection.createAnswer().then(answer => {
                return peerConnection.setLocalDescription(answer);
            }).then(() => {
                socket.send(JSON.stringify({ type: 'answer', sdp: peerConnection.localDescription }));
            });
        }

        // Handle answer message
        function handleAnswer(answer) {
            peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
        }

        // Handle ICE candidate
        function handleICECandidate(event) {
            if (event.candidate) {
                socket.send(JSON.stringify({ type: 'candidate', candidate: event.candidate }));
            }
        }

        // Handle remote video stream
        function handleTrack(event) {
            remoteStream = event.streams[0];
            remoteVideo.srcObject = remoteStream;
        }

        // Handle ICE candidate from the other peer
        function handleCandidate(candidate) {
            peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
        }
    </script>
</body>
</html>
